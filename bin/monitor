#!/usr/bin/env ruby
['monitors/diskfull_monitor', 'monitors/backup_monitor'].each do |file|
  require File.expand_path(File.dirname(__FILE__) + '/../lib/' + file)
end

if !ARGV[0].nil? and ['dev1','dev2','dev3','piqshare'].include?(ARGV[0])
  config_file = "monitor_config_#{ARGV[0]}.yml"
else
  puts 'Select test config file!'
  config_file = "monitor_config_test.yml"
end

monitors = [DiskfullMonitor, BackupMonitor]

if ARGV[1] and monitors.collect{|m| m.name}.include?(ARGV[1])
  puts "Execute #{ARGV[1]}!"
  monitors.each do |monitor|
    monitor.new(config_file).check if monitor.name == ARGV[1]
  end
else
  puts "Execute all configured monitor!"
  monitors.each do |monitor|
    monitor.new(config_file).check
  end
end
